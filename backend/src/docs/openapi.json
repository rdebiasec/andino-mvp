{
  "openapi": "3.0.3",
  "info": {
    "title": "Andino Postventa API",
    "version": "1.0.0",
    "description": "API para clasificación de reclamos utilizando Azure OpenAI"
  },
  "servers": [
    {
      "url": "http://localhost:4000",
      "description": "Desarrollo local"
    }
  ],
  "paths": {
    "/api/v1/health": {
      "get": {
        "summary": "Verificar estado de la API",
        "tags": [
          "Health"
        ],
        "responses": {
          "200": {
            "description": "Estado OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "example": "ok"
                    },
                    "uptime": {
                      "type": "number",
                      "example": 123.45
                    },
                    "version": {
                      "type": "string",
                      "example": "1.0.0"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/classify": {
      "post": {
        "summary": "Clasificar un reclamo",
        "tags": [
          "Clasificación"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "text"
                ],
                "properties": {
                  "text": {
                    "type": "string",
                    "minLength": 1,
                    "maxLength": 2000,
                    "example": "Necesito soporte con mi pedido que llegó dañado"
                  },
                  "channel": {
                    "type": "string",
                    "enum": [
                      "web",
                      "whatsapp",
                      "email"
                    ],
                    "example": "web"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Clasificación exitosa",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "intent": {
                      "type": "string",
                      "enum": [
                        "cancelacion",
                        "devolucion",
                        "soporte_tecnico",
                        "facturacion",
                        "otro"
                      ]
                    },
                    "category": {
                      "type": "string",
                      "enum": [
                        "producto",
                        "servicio",
                        "logistica",
                        "pago",
                        "otro"
                      ]
                    },
                    "tone": {
                      "type": "string",
                      "enum": [
                        "enojado",
                        "neutral",
                        "frustrado",
                        "positivo",
                        "urgente"
                      ]
                    },
                    "confidence": {
                      "type": "number",
                      "minimum": 0,
                      "maximum": 1
                    },
                    "caseId": {
                      "type": "string",
                      "example": "AND-20251108-04217"
                    },
                    "receivedAt": {
                      "type": "string",
                      "format": "date-time"
                    },
                    "channel": {
                      "type": "string"
                    },
                    "crm": {
                      "type": "object",
                      "properties": {
                        "status": {
                          "type": "string",
                          "enum": [
                            "REGISTERED",
                            "DUPLICATE_FOUND"
                          ]
                        },
                        "existingOpenCaseId": {
                          "type": [
                            "string",
                            "null"
                          ]
                        },
                        "isCustomer": {
                          "type": "boolean"
                        }
                      }
                    }
                  }
                },
                "examples": {
                  "success": {
                    "summary": "Respuesta ejemplo",
                    "value": {
                      "intent": "soporte_tecnico",
                      "category": "servicio",
                      "tone": "frustrado",
                      "confidence": 0.83,
                      "caseId": "AND-20251108-04217",
                      "receivedAt": "2025-11-08T15:04:05.000Z",
                      "channel": "web",
                      "crm": {
                        "status": "REGISTERED",
                        "existingOpenCaseId": null,
                        "isCustomer": true
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Error de validación",
            "content": {
              "application/problem+json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "type": {
                      "type": "string"
                    },
                    "title": {
                      "type": "string"
                    },
                    "status": {
                      "type": "number"
                    },
                    "detail": {
                      "type": "string"
                    },
                    "traceId": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/v1/cases": {
      "get": {
        "summary": "Listar casos procesados (memoria)",
        "tags": [
          "Casos"
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 1
            },
            "required": false
          },
          {
            "name": "pageSize",
            "in": "query",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100
            },
            "required": false
          }
        ],
        "responses": {
          "200": {
            "description": "Listado en memoria",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "items": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "caseId": {
                            "type": "string"
                          },
                          "text": {
                            "type": "string"
                          },
                          "channel": {
                            "type": "string"
                          },
                          "intent": {
                            "type": "string"
                          },
                          "category": {
                            "type": "string"
                          },
                          "tone": {
                            "type": "string"
                          },
                          "confidence": {
                            "type": "number"
                          },
                          "receivedAt": {
                            "type": "string",
                            "format": "date-time"
                          }
                        }
                      }
                    },
                    "total": {
                      "type": "number"
                    },
                    "page": {
                      "type": "number"
                    },
                    "pageSize": {
                      "type": "number"
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
